{% extends 'layout.html' %}
{% block title %}Your Downloader{% endblock %}
{% block body %}
<!-- Quote/testimonial aside-->

<aside class="text-center bg-gradient-primary-to-secondary pb-0">
    <div class="container p-2 p-md-5">
{#            <div class="row gx-5 justify-content-center">#}
{#                <div class="col-xl-8">#}
                <div class="h2 fs-3 text-white mb-4">"Youtube等网站视频下载"
                </div>
{#                </div>#}
        </div>
    </div>
    <div class="text-white">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"
             preserveAspectRatio="none" fill="currentColor" style="height: 3rem; width: 100%;">
            <polygon points="0,100 100,0 100,100"></polygon>
        </svg>
    </div>
</aside>

<section class="container text-center" id="searchForm">
    <form class="input-group" id="downloaderForm">
        {% csrf_token %}
        <input id="urlInputElement" name="url" class="form-control" type="text"
               placeholder="请输入或者粘贴视频网址" aria-label="请输入或者粘贴视频网址"/>
        <button type="submit" class="btn btn-primary" data-text-loading="正在获取视频信息" data-text-fetch="获取视频信息">获取视频信息
        </button>
    </form>
    <div id="info" class="row d-none">
    </div>
</section>

<script>
    (() => {
        function showInfo(json = {
            thumbnail: '', formats: [], status: 0, message: ''
        }) {
            let infoElement = document.querySelector('#info');
            infoElement.innerHTML = '';
            infoElement.classList.remove('d-none');

            if (!json.status) {
                let infoMessageElement = document.createElement('div');
                infoMessageElement.classList.add('alert', 'alert-info');
                infoMessageElement.textContent = json.message;
                infoElement.appendChild(infoMessageElement);
            } else {
                let infoFigureElement = document.createElement('figure');
                infoFigureElement.classList.add('text-center');
                infoElement.appendChild(infoFigureElement);
                let img = document.createElement('img');
                img.style.maxWidth = '320px';
                img.classList.add('img-fluid', 'img-thumbnail');
                img.src = json.thumbnail;
                infoFigureElement.appendChild(img);

                let title = document.createElement('h3');
                title.textContent = json.title;
                infoFigureElement.appendChild(title);

                let a = document.createElement('a');
                a.classList.add("btn", "btn-success", "w-100");
                a.href = json.download;
                a.target = "_blank";
                a.textContent = '下载最佳尺寸';
                infoElement.appendChild(a);
                let infoListElement = document.createElement('ul');
                infoListElement.classList.add('list-group');
                infoElement.appendChild(infoListElement);
                json.formats.forEach(row => {
                    let li = document.createElement('li');
                    li.classList.add('list-group-item');
                    let span = document.createElement('span');
                    span.href = row.url;
                    span.textContent = row.title+' ';
                    li.appendChild(span);
                    let a = document.createElement('a');
                    a.classList.add('btn','btn-success');
                    a.href = row.url;
                    a.textContent = '下载';
                    a.target = '_blank';
                    li.appendChild(a);
                    infoListElement.appendChild(li);
                });
            }
            enableButton();
        }

        function disableButton() {
            let btn = document.querySelector('#downloaderForm button[type=submit]');
            btn.disabled = true;
            btn.textContent = btn.dataset.textLoading;
        }

        function enableButton() {
            let btn = document.querySelector('#downloaderForm button[type=submit]');
            btn.removeAttribute("disabled");
            btn.textContent = btn.dataset.textFetch;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const form = document.querySelector('#downloaderForm');
            form.addEventListener('submit', e => {
                disableButton();
                document.querySelector('#info').classList.add('d-none');
                fetch(form.action, {
                    method: 'POST',
                    body: new FormData(form)
                }).then(res => {
                    let textRes = res.clone();
                    res.json().then(json => showInfo(json)||console.log(json)).catch(err => textRes.text().then(text => console.error(text) + enableButton()))
                });
                return e.preventDefault();
            });
        });
    })();
</script>
<!-- App features section-->
{% comment %} {# <section id="features">
        <div class="container px-5">
            <div class="row gx-5 align-items-center">
                <div class="col-lg-8 order-lg-1 mb-5 mb-lg-0">
                    <div class="container-fluid px-5">
                        <div class="row gx-5">
                            <div
                                class="col-md-6 mb-5">
                                <!-- Feature item-->
                                <div class="text-center">
                                    <i class="bi-phone icon-feature text-gradient d-block mb-3"></i>
                                    <h3 class="font-alt">Device Mockups</h3>
                                    <p class="text-muted mb-0">Ready to use HTML/CSS device mockups, no Photoshop required!</p>
                                </div>
                            </div>
                            <div
                                class="col-md-6 mb-5">
                                <!-- Feature item-->
                                <div class="text-center">
                                    <i class="bi-camera icon-feature text-gradient d-block mb-3"></i>
                                    <h3 class="font-alt">Flexible Use</h3>
                                    <p class="text-muted mb-0">Put an image, video, animation, or anything else in the screen!</p>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div
                                class="col-md-6 mb-5 mb-md-0">
                                <!-- Feature item-->
                                <div class="text-center">
                                    <i class="bi-gift icon-feature text-gradient d-block mb-3"></i>
                                    <h3 class="font-alt">Free to Use</h3>
                                    <p class="text-muted mb-0">As always, this theme is free to download and use for any purpose!</p>
                                </div>
                            </div>
                            <div
                                class="col-md-6">
                                <!-- Feature item-->
                                <div class="text-center">
                                    <i class="bi-patch-check icon-feature text-gradient d-block mb-3"></i>
                                    <h3 class="font-alt">Open Source</h3>
                                    <p class="text-muted mb-0">Since this theme is MIT licensed, you can use it commercially!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div
                    class="col-lg-4 order-lg-0">
                    <!-- Features section device mockup-->
                    <div class="features-device-mockup">
                        <svg class="circle" viewbox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <defs>
                                <linearGradient id="circleGradient" gradienttransform="rotate(45)">
                                    <stop class="gradient-start-color" offset="0%"></stop>
                                    <stop class="gradient-end-color" offset="100%"></stop>
                                </linearGradient>
                            </defs>
                            <circle cx="50" cy="50" r="50"></circle>
                        </svg>
                        <svg class="shape-1 d-none d-sm-block" viewbox="0 0 240.83 240.83" xmlns="http://www.w3.org/2000/svg">
                            <rect x="-32.54" y="78.39" width="305.92" height="84.05" rx="42.03" transform="translate(120.42 -49.88) rotate(45)"></rect>
                            <rect x="-32.54" y="78.39" width="305.92" height="84.05" rx="42.03" transform="translate(-49.88 120.42) rotate(-45)"></rect>
                        </svg>
                        <svg class="shape-2 d-none d-sm-block" viewbox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                            <circle cx="50" cy="50" r="50"></circle>
                        </svg>
                        <div class="device-wrapper">
                            <div class="device" data-device="iPhoneX" data-orientation="portrait" data-color="black">
                                <div class="screen bg-black">
                                    <!-- PUT CONTENTS HERE:-->
                                    <!-- * * This can be a video, image, or just about anything else.-->
                                    <!-- * * Set the max width of your media to 100% and the height to-->
                                    <!-- * * 100% like the demo example below.--><video muted="muted" autoplay="" loop="" style="max-width: 100%; height: 100%"> <source src="assets/img/demo-screen.mp4" type="video/mp4"/></video>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section> #} {% endcomment %}
{% comment %} <!-- Basic features section-->
{# <section class="bg-light">
                                                        <div class="container px-5">
                                                            <div class="row gx-5 align-items-center justify-content-center justify-content-lg-between">
                                                                <div class="col-12 col-lg-5">
                                                                    <h2 class="display-4 lh-1 mb-4">Enter a new age of web design</h2>
                                                                    <p class="lead fw-normal text-muted mb-5 mb-lg-0">This section is perfect for featuring some information about your application, why it was built, the problem it solves, or anything else! There's plenty of space for text here, so don't worry about writing too much.</p>
                                                                </div>
                                                                <div class="col-sm-8 col-md-6">
                                                                    <div class="px-5 px-sm-0"><img class="img-fluid rounded-circle" src="https://source.unsplash.com/u8Jn2rzYIps/900x900" alt="..."/></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </section> #} {% endcomment %}
{% comment %} <!-- Call to action section-->
{# <section class="cta"> <div class="cta-content">
                                                        <div class="container px-5">
                                                            <h2 class="text-white display-1 lh-1 mb-4">
                                                                Stop waiting.
                                                                <br/>
                                                                Start building.
                                                            </h2>
                                                            <a class="btn btn-outline-light py-3 px-4 rounded-pill" href="https://startbootstrap.com/theme/new-age" target="_blank">Download for free</a>
                                                        </div>
                                                    </div>
                                                </section> #} {% endcomment %}
{% comment %} <!-- App badge section-->
{# <section class="bg-gradient-primary-to-secondary" id="download">
                                                    <div class="container px-5">
                                                        <h2 class="text-center text-white font-alt mb-4">Get the app now!</h2>
                                                        <div class="d-flex flex-column flex-lg-row align-items-center justify-content-center">
                                                            <a class="me-lg-3 mb-4 mb-lg-0" href="#!"><img class="app-badge" src="assets/img/google-play-badge.svg" alt="..."/></a>
                                                            <a href="#!"><img class="app-badge" src="assets/img/app-store-badge.svg" alt="..."/></a>
                                                        </div>
                                                    </div>
                                                </section> #} {% endcomment %}
{%endblock%}